{
  "rules": {
    "users": {
      ".read": "root.child('admins').child(auth.uid).exists()",
      "$uid": {
        ".read": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        ".write": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$/)"
        },
        "points": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "rfidUid": {
          ".write": "$uid === auth.uid || root.child('admins').child(auth.uid).exists() || auth == null",
          ".validate": "newData.isString()"
        },
        "displayName": {
          ".validate": "newData.isString()"
        }
      }
    },
    "disposals": {
      "$uid": {
        ".read": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        ".write": true,
        "$disposalId": {
          "type": {
            ".validate": "newData.isString() && (newData.val() === 'bio' || newData.val() === 'nonbio')"
          },
          "points": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          "timestamp": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          }
        }
      }
    },
    "storeItems": {
      ".read": true,
      "$itemId": {
        ".write": "root.child('admins').child(auth.uid).exists()",
        "stock": {
          ".write": "auth != null && data.parent().exists()",
          ".validate": "newData.isNumber() || newData.val() === 'unlimited' || newData.val() === 'out'"
        },
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "points": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "icon": {
          ".validate": "newData.isString()"
        }
      }
    },
    "redemptions": {
      ".read": "root.child('admins').child(auth.uid).exists()",
      "$uid": {
        ".read": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        ".write": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        "$redemptionId": {
          "itemId": {
            ".validate": "newData.isString()"
          },
          "itemName": {
            ".validate": "newData.isString()"
          },
          "points": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          "verificationCode": {
            ".validate": "newData.isString() && newData.val().length >= 8"
          },
          "timestamp": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          "status": {
            ".validate": "newData.isString() && (newData.val() === 'pending' || newData.val() === 'collected')"
          }
        }
      }
    },
    "rfidLinking": {
      "$uid": {
        ".read": "$uid === auth.uid || root.child('admins').child(auth.uid).exists()",
        ".write": "$uid === auth.uid",
        "requested": {
          ".validate": "newData.isBoolean()"
        },
        "timestamp": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        }
      }
    },
    "admins": {
      ".read": false,
      ".write": false,
      "$adminId": {
        ".read": "$adminId === auth.uid || root.child('admins').child(auth.uid).exists()",
        ".write": false
      }
    }
  }
}
